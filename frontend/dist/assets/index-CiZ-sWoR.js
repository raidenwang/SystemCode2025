import{au as Z,O as Xe,a as Ze,d as el,r as f,P as re,b1 as ll,ag as tl,w as al,e as p,a6 as ie,c as T,o as r,f as l,h as a,m as N,af as Y,k as o,a5 as k,l as pe,L,am as O,i as m,n as h,ac as me,j as y,A as ce}from"./index-BehJRYYk.js";import{e as ol,l as nl,f as fe,h as sl,i as ul,r as dl,j as rl,k as il}from"./user-DDiqOZsJ.js";function pl(S){return Z({url:"/hospital/doctor/add",method:"post",data:S})}function ml(S){return Z({url:"/hospital/doctor/updateDoctor",method:"post",data:S})}function cl(S){return Z({url:"/hospital/doctor/deleteDoctor",method:"post",data:S})}const fl={class:"app-container"},vl={class:"head-container"},_l={class:"head-container"},bl={class:"dialog-footer"},gl=N("div",{class:"el-upload__text"},[h("将文件拖到此处，或"),N("em",null,"点击上传")],-1),hl={class:"el-upload__tip text-center"},yl={class:"el-upload__tip"},kl=N("span",null,"仅允许导入xls、xlsx格式文件。",-1),Nl={class:"dialog-footer"},Vl=Xe({name:"User"}),Il=Object.assign(Vl,{setup(S){const ve=Ze(),{proxy:c}=el(),{sys_normal_disable:ee,sys_user_sex:_e}=c.useDict("sys_normal_disable","sys_user_sex"),j=f([]),x=f(!1),Q=f(!0),z=f(!0),E=f([]),le=f(!0),te=f(!0),H=f(0),G=f(""),P=f([]),K=f(""),B=f(void 0),be=f(void 0),M=f([]),J=f([]),b=re({open:!1,title:"",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer "+ll()},url:"/prod-api/system/user/importData"}),I=f([{key:0,label:"用户编号",visible:!0},{key:1,label:"用户名称",visible:!0},{key:2,label:"用户昵称",visible:!0},{key:3,label:"部门",visible:!0},{key:4,label:"手机号码",visible:!0},{key:5,label:"状态",visible:!0},{key:6,label:"创建时间",visible:!0}]),ge=re({form:{},queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:void 0,deptId:void 0,deptName:void 0,postIds:void 0},rules:{userName:[{required:!0,message:"用户名称不能为空",trigger:"blur"},{min:2,max:20,message:"用户名称长度必须介于 2 和 20 之间",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{min:5,max:20,message:"用户密码长度必须介于 5 和 20 之间",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phonenumber:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}}),W=f(""),F=f(""),{queryParams:_,form:s,rules:he}=tl(ge),ye=(n,t)=>n?t.label.indexOf(n)!==-1:!0;al(K,n=>{c.$refs.deptTreeRef.filter(n)});function ke(){ol().then(n=>{B.value=n.data})}function U(){Q.value=!0,nl(c.addDateRange(_.value,P.value)).then(n=>{Q.value=!1,j.value=n.rows,H.value=n.total})}function Ne(n){_.value.deptId=n.id,q()}function q(){_.value.pageNum=1,U()}function Ve(){P.value=[],c.resetForm("queryRef"),_.value.deptId=void 0,c.$refs.deptTreeRef.setCurrentKey(null),q()}function ae(n){const t=n.userId||E.value,v=j.value.filter(d=>E.value.includes(d.userId)).map(d=>{var i;return{name:d.userName,deptName:((i=d.dept)==null?void 0:i.deptName)||"未知部门"}});c.$modal.confirm('是否确认删除用户编号为"'+t+'"的数据项？').then(function(){return cl(v),sl(t)}).then(()=>{U(),c.$modal.msgSuccess("删除成功")}).catch(()=>{})}function we(){c.download("system/user/export",{..._.value},`user_${new Date().getTime()}.xlsx`)}function xe(n){let t=n.status==="0"?"启用":"停用";c.$modal.confirm('确认要"'+t+'""'+n.userName+'"用户吗?').then(function(){return ul(n.userId,n.status)}).then(()=>{c.$modal.msgSuccess(t+"成功")}).catch(function(){n.status=n.status==="0"?"1":"0"})}function Ie(n){const t=n.userId;ve.push("/system/user-auth/role/"+t)}function Ue(n){c.$prompt('请输入"'+n.userName+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:/^.{5,20}$/,inputErrorMessage:"用户密码长度必须介于 5 和 20 之间"}).then(({value:t})=>{dl(n.userId,t).then(u=>{c.$modal.msgSuccess("修改成功，新密码是："+t)})}).catch(()=>{})}function Ce(n){E.value=n.map(t=>t.userId),le.value=n.length!=1,te.value=!n.length}function De(){b.title="用户导入",b.open=!0}function Se(){c.download("system/user/importTemplate",{},`user_template_${new Date().getTime()}.xlsx`)}const $e=(n,t,u)=>{b.isUploading=!0},Re=(n,t,u)=>{b.open=!1,b.isUploading=!1,c.$refs.uploadRef.handleRemove(t),c.$alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>"+n.msg+"</div>","导入结果",{dangerouslyUseHTMLString:!0}),U()};function Te(){c.$refs.uploadRef.submit()}function X(){s.value={userId:void 0,deptId:void 0,deptName:void 0,userName:void 0,nickName:void 0,password:void 0,phonenumber:void 0,email:void 0,sex:void 0,status:"0",remark:void 0,postIds:[],roleIds:[]},W.value="",F.value="",c.resetForm("userRef")}function Pe(){x.value=!1,X()}function Be(){X(),fe().then(n=>{M.value=n.posts,J.value=n.roles,x.value=!0,G.value="添加用户",s.value.password=be.value})}function oe(n){X();const t=n.userId||E.value;fe(t).then(u=>{if(s.value=u.data,M.value=u.posts,J.value=u.roles,s.value.postIds=u.postIds,s.value.roleIds=u.roleIds,x.value=!0,G.value="修改用户",s.password="",W.value=u.data.userName,u.data.deptName)F.value=u.data.deptName;else{const v=s.value.deptId;console.log("deptId",v),v?F.value=se(B.value,v):F.value=""}})}function Fe(){c.$refs.userRef.validate(async n=>{if(n)if(s.value.userId!=null){rl(s.value).then($=>{c.$modal.msgSuccess("修改成功"),x.value=!1,U()});const t=F.value,u=s.value.deptName,v=s.value.postIds[0],d=ne(v),i=s.value.remark,D={oldDeptName:t,oldName:W.value,name:s.value.userName,title:d,info:i,deptName:u};ml(D)}else{il(s.value).then($=>{c.$modal.msgSuccess("新增成功"),x.value=!1,U()});const t=s.value.deptName,u=s.value.postIds[0];console.log(u);const v=s.value.userName,d=ne(u),i=s.value.remark;pl({name:v,title:d,info:i,deptName:t})}})}function ne(n){const t=M.value.find(u=>u.postId===n);return t?t.postName:""}function qe(n){const t=(u,v)=>{for(const d of u){if(d.id===v)return d.label;if(d.children&&d.children.length>0){const i=t(d.children,v);if(i)return i}}return""};s.value.deptName=t(B.value,n)}function se(n,t){for(const u of n){if(u.id===t)return u.label;if(u.children&&u.children.length>0){const v=se(u.children,t);if(v)return v}}return""}return ke(),U(),(n,t)=>{const u=p("el-input"),v=p("el-tree"),d=p("el-col"),i=p("el-form-item"),D=p("el-option"),$=p("el-select"),Le=p("el-date-picker"),g=p("el-button"),ue=p("el-form"),Oe=p("right-toolbar"),C=p("el-row"),V=p("el-table-column"),ze=p("el-switch"),A=p("el-tooltip"),Ee=p("el-table"),Ke=p("pagination"),Me=p("el-tree-select"),Ae=p("el-radio"),Ye=p("el-radio-group"),de=p("el-dialog"),je=p("upload-filled"),Qe=p("el-icon"),He=p("el-checkbox"),Ge=p("el-link"),Je=p("el-upload"),w=ie("hasPermi"),We=ie("loading");return r(),T("div",fl,[l(C,{gutter:20},{default:a(()=>[l(d,{span:4,xs:24},{default:a(()=>[N("div",vl,[l(u,{modelValue:o(K),"onUpdate:modelValue":t[0]||(t[0]=e=>Y(K)?K.value=e:null),placeholder:"请输入部门名称",clearable:"","prefix-icon":"Search",style:{"margin-bottom":"20px"}},null,8,["modelValue"])]),N("div",_l,[l(v,{data:o(B),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":ye,ref:"deptTreeRef","node-key":"id","highlight-current":"","default-expand-all":"",onNodeClick:Ne},null,8,["data"])])]),_:1}),l(d,{span:20,xs:24},{default:a(()=>[k(l(ue,{model:o(_),ref:"queryRef",inline:!0,"label-width":"68px"},{default:a(()=>[l(i,{label:"用户名称",prop:"userName"},{default:a(()=>[l(u,{modelValue:o(_).userName,"onUpdate:modelValue":t[1]||(t[1]=e=>o(_).userName=e),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"},onKeyup:pe(q,["enter"])},null,8,["modelValue"])]),_:1}),l(i,{label:"手机号码",prop:"phonenumber"},{default:a(()=>[l(u,{modelValue:o(_).phonenumber,"onUpdate:modelValue":t[2]||(t[2]=e=>o(_).phonenumber=e),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:pe(q,["enter"])},null,8,["modelValue"])]),_:1}),l(i,{label:"状态",prop:"status"},{default:a(()=>[l($,{modelValue:o(_).status,"onUpdate:modelValue":t[3]||(t[3]=e=>o(_).status=e),placeholder:"用户状态",clearable:"",style:{width:"240px"}},{default:a(()=>[(r(!0),T(L,null,O(o(ee),e=>(r(),m(D,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"创建时间",style:{width:"308px"}},{default:a(()=>[l(Le,{modelValue:o(P),"onUpdate:modelValue":t[4]||(t[4]=e=>Y(P)?P.value=e:null),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),l(i,null,{default:a(()=>[l(g,{type:"primary",icon:"Search",onClick:q},{default:a(()=>[h("搜索")]),_:1}),l(g,{icon:"Refresh",onClick:Ve},{default:a(()=>[h("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[me,o(z)]]),l(C,{gutter:10,class:"mb8"},{default:a(()=>[l(d,{span:1.5},{default:a(()=>[k((r(),m(g,{type:"primary",plain:"",icon:"Plus",onClick:Be},{default:a(()=>[h("新增")]),_:1})),[[w,["system:user:add"]]])]),_:1}),l(d,{span:1.5},{default:a(()=>[k((r(),m(g,{type:"success",plain:"",icon:"Edit",disabled:o(le),onClick:oe},{default:a(()=>[h("修改")]),_:1},8,["disabled"])),[[w,["system:user:edit"]]])]),_:1}),l(d,{span:1.5},{default:a(()=>[k((r(),m(g,{type:"danger",plain:"",icon:"Delete",disabled:o(te),onClick:ae},{default:a(()=>[h("删除")]),_:1},8,["disabled"])),[[w,["system:user:remove"]]])]),_:1}),l(d,{span:1.5},{default:a(()=>[k((r(),m(g,{type:"info",plain:"",icon:"Upload",onClick:De},{default:a(()=>[h("导入")]),_:1})),[[w,["system:user:import"]]])]),_:1}),l(d,{span:1.5},{default:a(()=>[k((r(),m(g,{type:"warning",plain:"",icon:"Download",onClick:we},{default:a(()=>[h("导出")]),_:1})),[[w,["system:user:export"]]])]),_:1}),l(Oe,{showSearch:o(z),"onUpdate:showSearch":t[5]||(t[5]=e=>Y(z)?z.value=e:null),onQueryTable:U,columns:o(I)},null,8,["showSearch","columns"])]),_:1}),k((r(),m(Ee,{data:o(j),onSelectionChange:Ce},{default:a(()=>[l(V,{type:"selection",width:"50",align:"center"}),o(I)[0].visible?(r(),m(V,{label:"用户编号",align:"center",key:"userId",prop:"userId"})):y("",!0),o(I)[1].visible?(r(),m(V,{label:"用户名称",align:"center",key:"userName",prop:"userName","show-overflow-tooltip":!0})):y("",!0),o(I)[2].visible?(r(),m(V,{label:"用户昵称",align:"center",key:"nickName",prop:"nickName","show-overflow-tooltip":!0})):y("",!0),o(I)[3].visible?(r(),m(V,{label:"部门",align:"center",key:"deptName",prop:"dept.deptName","show-overflow-tooltip":!0})):y("",!0),o(I)[4].visible?(r(),m(V,{label:"手机号码",align:"center",key:"phonenumber",prop:"phonenumber",width:"120"})):y("",!0),o(I)[5].visible?(r(),m(V,{label:"状态",align:"center",key:"status"},{default:a(e=>[l(ze,{modelValue:e.row.status,"onUpdate:modelValue":R=>e.row.status=R,"active-value":"0","inactive-value":"1",onChange:R=>xe(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):y("",!0),o(I)[6].visible?(r(),m(V,{key:6,label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:a(e=>[N("span",null,ce(n.parseTime(e.row.createTime)),1)]),_:1})):y("",!0),l(V,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:a(e=>[e.row.userId!==1?(r(),m(A,{key:0,content:"修改",placement:"top"},{default:a(()=>[k(l(g,{link:"",type:"primary",icon:"Edit",onClick:R=>oe(e.row)},null,8,["onClick"]),[[w,["system:user:edit"]]])]),_:2},1024)):y("",!0),e.row.userId!==1?(r(),m(A,{key:1,content:"删除",placement:"top"},{default:a(()=>[k(l(g,{link:"",type:"primary",icon:"Delete",onClick:R=>ae(e.row)},null,8,["onClick"]),[[w,["system:user:remove"]]])]),_:2},1024)):y("",!0),e.row.userId!==1?(r(),m(A,{key:2,content:"重置密码",placement:"top"},{default:a(()=>[k(l(g,{link:"",type:"primary",icon:"Key",onClick:R=>Ue(e.row)},null,8,["onClick"]),[[w,["system:user:resetPwd"]]])]),_:2},1024)):y("",!0),e.row.userId!==1?(r(),m(A,{key:3,content:"分配角色",placement:"top"},{default:a(()=>[k(l(g,{link:"",type:"primary",icon:"CircleCheck",onClick:R=>Ie(e.row)},null,8,["onClick"]),[[w,["system:user:edit"]]])]),_:2},1024)):y("",!0)]),_:1})]),_:1},8,["data"])),[[We,o(Q)]]),k(l(Ke,{total:o(H),page:o(_).pageNum,"onUpdate:page":t[6]||(t[6]=e=>o(_).pageNum=e),limit:o(_).pageSize,"onUpdate:limit":t[7]||(t[7]=e=>o(_).pageSize=e),onPagination:U},null,8,["total","page","limit"]),[[me,o(H)>0]])]),_:1})]),_:1}),l(de,{title:o(G),modelValue:o(x),"onUpdate:modelValue":t[19]||(t[19]=e=>Y(x)?x.value=e:null),width:"600px","append-to-body":""},{footer:a(()=>[N("div",bl,[l(g,{type:"primary",onClick:Fe},{default:a(()=>[h("确 定")]),_:1}),l(g,{onClick:Pe},{default:a(()=>[h("取 消")]),_:1})])]),default:a(()=>[l(ue,{model:o(s),rules:o(he),ref:"userRef","label-width":"80px"},{default:a(()=>[l(C,null,{default:a(()=>[l(d,{span:12},{default:a(()=>[l(i,{label:"用户昵称",prop:"nickName"},{default:a(()=>[l(u,{modelValue:o(s).nickName,"onUpdate:modelValue":t[8]||(t[8]=e=>o(s).nickName=e),placeholder:"请输入用户昵称",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:12},{default:a(()=>[l(i,{label:"归属部门",prop:"deptId"},{default:a(()=>[l(Me,{modelValue:o(s).deptId,"onUpdate:modelValue":t[9]||(t[9]=e=>o(s).deptId=e),data:o(B),props:{value:"id",label:"label",children:"children"},"value-key":"id",placeholder:"请选择归属部门","check-strictly":"",onChange:qe},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1}),l(C,null,{default:a(()=>[l(d,{span:12},{default:a(()=>[l(i,{label:"手机号码",prop:"phonenumber"},{default:a(()=>[l(u,{modelValue:o(s).phonenumber,"onUpdate:modelValue":t[10]||(t[10]=e=>o(s).phonenumber=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1})]),_:1}),l(d,{span:12},{default:a(()=>[l(i,{label:"邮箱",prop:"email"},{default:a(()=>[l(u,{modelValue:o(s).email,"onUpdate:modelValue":t[11]||(t[11]=e=>o(s).email=e),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(C,null,{default:a(()=>[l(d,{span:12},{default:a(()=>[o(s).userId==null?(r(),m(i,{key:0,label:"用户名称",prop:"userName"},{default:a(()=>[l(u,{modelValue:o(s).userName,"onUpdate:modelValue":t[12]||(t[12]=e=>o(s).userName=e),placeholder:"请输入用户名称",maxlength:"30"},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1}),l(d,{span:12},{default:a(()=>[o(s).userId==null?(r(),m(i,{key:0,label:"用户密码",prop:"password"},{default:a(()=>[l(u,{modelValue:o(s).password,"onUpdate:modelValue":t[13]||(t[13]=e=>o(s).password=e),placeholder:"请输入用户密码",type:"password",maxlength:"20","show-password":""},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1})]),_:1}),l(C,null,{default:a(()=>[l(d,{span:12},{default:a(()=>[l(i,{label:"用户性别"},{default:a(()=>[l($,{modelValue:o(s).sex,"onUpdate:modelValue":t[14]||(t[14]=e=>o(s).sex=e),placeholder:"请选择"},{default:a(()=>[(r(!0),T(L,null,O(o(_e),e=>(r(),m(D,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:12},{default:a(()=>[l(i,{label:"状态"},{default:a(()=>[l(Ye,{modelValue:o(s).status,"onUpdate:modelValue":t[15]||(t[15]=e=>o(s).status=e)},{default:a(()=>[(r(!0),T(L,null,O(o(ee),e=>(r(),m(Ae,{key:e.value,label:e.value},{default:a(()=>[h(ce(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(C,null,{default:a(()=>[l(d,{span:12},{default:a(()=>[l(i,{label:"岗位"},{default:a(()=>[l($,{modelValue:o(s).postIds,"onUpdate:modelValue":t[16]||(t[16]=e=>o(s).postIds=e),multiple:"",placeholder:"请选择"},{default:a(()=>[(r(!0),T(L,null,O(o(M),e=>(r(),m(D,{key:e.postId,label:e.postName,value:e.postId,disabled:e.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(d,{span:12},{default:a(()=>[l(i,{label:"角色"},{default:a(()=>[l($,{modelValue:o(s).roleIds,"onUpdate:modelValue":t[17]||(t[17]=e=>o(s).roleIds=e),multiple:"",placeholder:"请选择"},{default:a(()=>[(r(!0),T(L,null,O(o(J),e=>(r(),m(D,{key:e.roleId,label:e.roleName,value:e.roleId,disabled:e.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(C,null,{default:a(()=>[l(d,{span:24},{default:a(()=>[l(i,{label:"备注"},{default:a(()=>[l(u,{modelValue:o(s).remark,"onUpdate:modelValue":t[18]||(t[18]=e=>o(s).remark=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(de,{title:o(b).title,modelValue:o(b).open,"onUpdate:modelValue":t[22]||(t[22]=e=>o(b).open=e),width:"400px","append-to-body":""},{footer:a(()=>[N("div",Nl,[l(g,{type:"primary",onClick:Te},{default:a(()=>[h("确 定")]),_:1}),l(g,{onClick:t[21]||(t[21]=e=>o(b).open=!1)},{default:a(()=>[h("取 消")]),_:1})])]),default:a(()=>[l(Je,{ref:"uploadRef",limit:1,accept:".xlsx, .xls",headers:o(b).headers,action:o(b).url+"?updateSupport="+o(b).updateSupport,disabled:o(b).isUploading,"on-progress":$e,"on-success":Re,"auto-upload":!1,drag:""},{tip:a(()=>[N("div",hl,[N("div",yl,[l(He,{modelValue:o(b).updateSupport,"onUpdate:modelValue":t[20]||(t[20]=e=>o(b).updateSupport=e)},null,8,["modelValue"]),h("是否更新已经存在的用户数据 ")]),kl,l(Ge,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:Se},{default:a(()=>[h("下载模板")]),_:1})])]),default:a(()=>[l(Qe,{class:"el-icon--upload"},{default:a(()=>[l(je)]),_:1}),gl]),_:1},8,["headers","action","disabled"])]),_:1},8,["title","modelValue"])])}}});export{Il as default};
