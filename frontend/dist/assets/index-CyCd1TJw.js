import{_ as oe,r as l,Q as se,Y as ce,e as r,c as h,o as i,f as o,m as C,h as s,i as m,j as D,k,aR as re,a4 as ie,n as F,A as R,l as $,L as W,am as j,an as G,E as ue,aE as B,aS as de,a9 as pe,aT as fe}from"./index-BehJRYYk.js";import{l as ve,g as he}from"./knowledge-D-I8rEGo.js";import{E as me,g as ge,a as _e,b as ye,c as we,d as Ce,e as ke}from"./eventBus-Bt2tmyRz.js";import xe from"./ChatDialog-DD1QPqWb.js";import"./mitt-DJ65BbbF.js";const be={class:"container inserted"},Ie=["onClick","onMouseenter","onMouseleave"],Ae=["id"],Le={class:"select-box"},Ee={class:"send-msg-box"},Te={__name:"index",setup(Ve){const x=l(window.innerHeight-110),b=l([]),c=l(-1),M=l([]),I=l(["KBa124d786fee0475696806e6319bebdc3"]),p=l(""),A=l(!1),f=l(""),L=l(!1),g=l(void 0);l(!1);const S=l(null),E=l(null),_=new Map;let y=!1;const w=l([]);function O(){x.value=window.innerHeight-110}const H=ve.throttle(O,500);se(()=>{window.addEventListener("resize",H)}),ce(()=>{window.removeEventListener("resize",H)});function T(){_e().then(e=>{b.value=e.data})}me.on("select-plugin",e=>{e&&(g.value=e),L.value=!0}),ge().then(e=>{e.data.forEach(t=>{_.set(t.id,t.name)})}),T(),he().then(e=>{M.value=e.data});async function Q(e){if(y){B({type:"warning",message:"等待问答回复中，请勿切换对话"});return}if(e===c.value)return;let t=!1,n=null;setTimeout(()=>{t||(n=K(E.value,"正在获取该对话历史记录"))},500),c.value=e;try{const u=await we(e);t=!0,w.value=u.data}finally{n&&N(n)}}async function P(){var u;c.value===-1&&(f.value=p.value,await z());const e=(u=b.value)==null?void 0:u.find(d=>d.id===c.value),t=e&&e.promptId;console.log("promptId",t);let n=!1;if(p.value!==""){let d=null;setTimeout(()=>{n||(d=K(E.value))},500);try{y=!0;const v=await ke({chatId:c.value,promptId:t||g.value,content:p.value,kbIds:I.value});n=!0,y=!1,console.log("获取的res:",v),w.value.push(v.data.question,{...v.data.answer,chatSourceList:v.data.chatSourceList}),p.value="",X()}finally{y=!1,d&&N(d)}}}function K(e,t="AI正在思考，请等待回复"){const n=l(null);return n.value=de.service({lock:!0,target:e,fullscreen:!0,text:t}),n}function N(e){e.value.close()}function Y(e){ue.confirm("你确认要删除该对话吗","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await Ce(e)).code===200&&(T(),B({type:"success",message:"删除成功"}))}).catch(()=>{B({type:"info",message:"取消删除"})})}async function z(){if(A.value=!1,f.value!==""){const e=await ye(f.value,g.value);T(),console.log(e),c.value=e.data,w.value=[],f.value=""}}const J=re({loader:()=>fe(()=>import("./ChoosePlugin-u4-Mip27.js"),__vite__mapDeps([0,1,2,3,4,5]))});function X(){pe(()=>{const e=S.value.wrapRef;e&&(e.scrollTop=e.scrollHeight)})}function Z(e,t){e.target.querySelector(".one-chat-text").classList.add("show-all-text")}function ee(e,t){if(c.value===t)return;e.target.querySelector(".one-chat-text").classList.remove("show-all-text")}return(e,t)=>{const n=r("el-button"),u=r("el-input"),d=r("Fragment"),v=r("Delete"),te=r("el-icon"),U=r("el-scrollbar"),q=r("el-col"),ae=r("el-option"),le=r("el-select"),ne=r("el-row");return i(),h("div",be,[o(ie,{name:"fade"},{default:s(()=>[L.value?D("",!0):(i(),m(k(J),{key:0}))]),_:1}),C("div",{class:"open-choose-plugin-compoent-btn",onClick:t[0]||(t[0]=a=>L.value=!1)}," 重新选择插件 "),o(ne,null,{default:s(()=>[o(q,{span:7,class:"left-chat-list"},{default:s(()=>[o(d,null,{default:s(()=>[A.value?(i(),m(u,{key:1,modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=a=>f.value=a),placeholder:"请输入对话标题，回车继续",class:"add-chat-btn",onKeyup:t[3]||(t[3]=$(()=>z(),["enter"]))},null,8,["modelValue"])):(i(),m(n,{key:0,type:"primary",class:"add-chat-btn",plain:"",onClick:t[1]||(t[1]=a=>A.value=!0)},{default:s(()=>[F("新建对话 ( "+R(k(_).get(g.value))+" )",1)]),_:1}))]),_:1}),o(U,{height:x.value,class:"chat-list-scroll"},{default:s(()=>[(i(!0),h(W,null,j(b.value,a=>(i(),h("div",{key:a.id,class:G(["one-chat",{active:a.id==c.value}]),onClick:()=>Q(a.id),onMouseenter:V=>Z(V,a.id),onMouseleave:V=>ee(V,a.id)},[C("span",{class:G(["one-chat-text",{"show-all-text":a.id==c.value}])},R(a.chatName),3),k(_).has(a.promptId)?(i(),h("span",{key:0,class:"one-chat-plugin-name",id:a.id},"( "+R(k(_).get(a.promptId))+" )",9,Ae)):D("",!0),c.value==a.id?(i(),m(d,{key:1,class:"chat-delete-icon",onClick:()=>Y(a.id)},{default:s(()=>[o(te,null,{default:s(()=>[o(v)]),_:1})]),_:2},1032,["onClick"])):D("",!0)],42,Ie))),128))]),_:1},8,["height"])]),_:1}),o(q,{span:17,class:"right-chat-window"},{default:s(()=>[o(d,{ref_key:"chatDialogRef",ref:E},{default:s(()=>[o(U,{height:x.value-140,class:"chat-window-scroll",ref_key:"scrollbarRef",ref:S},{default:s(()=>[o(xe,{propsArray:w.value},null,8,["propsArray"])]),_:1},8,["height"])]),_:1},512),C("div",Le,[o(le,{modelValue:I.value,"onUpdate:modelValue":t[4]||(t[4]=a=>I.value=a),placeholder:"请选择知识库",size:"large",multiple:"","collapse-tags":"",style:{width:"240px"}},{default:s(()=>[(i(!0),h(W,null,j(M.value,a=>(i(),m(ae,{key:a.id,label:a.name,value:a.kbId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),C("div",Ee,[o(u,{modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=a=>p.value=a),placeholder:"请输入内容",class:"send-msg-inp",onKeyup:$(P,["enter"])},null,8,["modelValue"]),o(n,{type:"primary",class:"send-msg-btn",onClick:t[6]||(t[6]=a=>P())},{default:s(()=>[F("发送")]),_:1})])]),_:1})]),_:1})])}}},He=oe(Te,[["__scopeId","data-v-b11c1478"]]);export{He as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/ChoosePlugin-u4-Mip27.js","assets/eventBus-Bt2tmyRz.js","assets/index-BehJRYYk.js","assets/index-DgdiySFF.css","assets/mitt-DJ65BbbF.js","assets/ChoosePlugin-D4CPQWU8.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}